<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/bootstrap.min.css' />
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.1.1/Chart.min.js'></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>

  <div class='page-result-left'>
  <a href="/expense/input" id="add"> Add Expense</a><br><br>

  <h1>Your Total Budget = <%= accounting.formatMoney(sum, "Rp. ", 0) %></h1>
  <hr>

  <!---------------------------------------------------------------------------------------------------->
  <% let foodSum = 0 %>
  <% for(let i=0; i < foods.length; i++) { %>
  <% foodSum += foods[i].expense %>
  <% } %>

  <h2>Food & Drinks</h2>
  <table>
    <tr>
      <td>Limit </td>
      <td><%= accounting.formatMoney(limits[0].limit, "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Total Expense</td>
      <td><%= accounting.formatMoney(foodSum, "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Balance</td>
      <td><span id=''><%= accounting.formatMoney((limits[0].limit - foodSum), "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Status</td>
      <% if(foodSum < limits[0].limit*0.3 ) {%>
        <td style="background-color: green; color: white;">SAFE</td>
      <% } else if (foodSum < limits[0].limit*0.7){ %>
        <td style="background-color: yellow; color: red;">WARNING</td>
      <% } else if (foodSum > limits[0].limit*0.7 && foodSum < limits[1].limit){ %>
        <td style="background-color: red; color: white;">DANGER</td>
      <% } else { %>
        <td style="background-color: red; color: yellow;">OUT OF BUDGET</td>
      <% } %>
    </tr>
  </table>
  <br>

  <table>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Expenses</th>
      <th style='text-align: center;'>Action</th>
    </tr>

  <% for(let i=0; i < foods.length; i++) { %>
    <tr>
      <td><%= convDate.formatDate(foods[i].date) %></td>
      <td><%= foods[i].description %></td>
      <td><%= accounting.formatMoney(foods[i].expense, "Rp. ", 0) %></td>
      <td><a href='/expense/edit/<%= foods[i].id %>'>EDIT</a> | <a href='/expense/delete/<%= foods[i].id %>'>DELETE</a></td>
    </tr>
  <% } %>
  </table>
  <br><br><hr>

  <!---------------------------------------------------------------------------------------------------->
  <% let transportSum = 0 %>
  <% for(let i=0; i < transports.length; i++) { %>
  <% transportSum += transports[i].expense %>
  <% } %>

  <h2>Transport</h2>
  <table>
    <tr>
      <td>Limit </td>
      <td><%= accounting.formatMoney(limits[1].limit, "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Total Expense</td>
      <td><%= accounting.formatMoney(transportSum, "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Balance</td>
      <td><span id=''><%= accounting.formatMoney((limits[1].limit - transportSum), "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Status</td>
      <% if(transportSum < limits[1].limit*0.3 ) {%>
        <td style="background-color: green; color: white;">SAFE</td>
      <% } else if (transportSum < limits[1].limit*0.7){ %>
        <td style="background-color: yellow; color: red;">WARNING</td>
      <% } else if (transportSum > limits[1].limit*0.7 && transportSum < limits[1].limit){ %>
        <td style="background-color: red; color: white;">DANGER</td>
      <% } else { %>
        <td style="background-color: red; color: yellow;">OUT OF BUDGET</td>
      <% } %>
    </tr>
  </table>
  <br>

  <table>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Expenses</th>
      <th style='text-align: center;'>Action</th>
    </tr>

  <% for(let i=0; i < transports.length; i++) { %>
    <tr>
      <td><%= convDate.formatDate(transports[i].date) %></td>
      <td><%= transports[i].description %></td>
      <td><%= accounting.formatMoney(transports[i].expense, "Rp. ", 0) %></td>
      <td><a href='/expense/edit/<%= transports[i].id %>'>EDIT</a> | <a href='/expense/delete/<%= transports[i].id %>'>DELETE</a></td>
    </tr>
  <% } %>
  </table>
  <br><br><hr>

  <!---------------------------------------------------------------------------------------------------->

  <% let entertainmentSum = 0 %>
  <% for(let i=0; i < entertainments.length; i++) { %>
  <% entertainmentSum += entertainments[i].expense %>
  <% } %>

  <h2>Entertainment</h2>
  <table>
    <tr>
      <td>Limit </td>
      <td><%= accounting.formatMoney(limits[2].limit, "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Total Expense</td>
      <td><%= accounting.formatMoney(entertainmentSum, "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Balance</td>
      <td><span id=''><%= accounting.formatMoney((limits[2].limit - entertainmentSum), "Rp. ", 0) %></td>
    </tr>
    <tr>
      <td>Status</td>
      <% if(entertainmentSum < limits[2].limit*0.3 ) {%>
        <td style="background-color: green; color: white;">SAFE</td>
      <% } else if (entertainmentSum < limits[2].limit*0.7){ %>
        <td style="background-color: yellow; color: red;">WARNING</td>
      <% } else if (entertainmentSum > limits[2].limit*0.7 && entertainmentSum < limits[2].limit){ %>
        <td style="background-color: red; color: white;">DANGER</td>
      <% } else { %>
        <td style="background-color: red; color: yellow;">OUT OF BUDGET</td>
      <% } %>
    </tr>
  </table>
  <br>

  <table>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Expenses</th>
      <th style='text-align: center'>Action</th>
    </tr>

  <% for(let i=0; i < entertainments.length; i++) { %>
    <tr>
      <td><%= convDate.formatDate(entertainments[i].date) %></td>
      <td><%= entertainments[i].description %></td>
      <td><%= accounting.formatMoney(entertainments[i].expense, "Rp. ", 0) %></td>
      <td><a href='/expense/edit/<%= entertainments[i].id %>'>EDIT</a> | <a href='/expense/delete/<%= entertainments[i].id %>'>DELETE</a></td>
    </tr>
  <% } %>
  </table>
  </div>

  <!---------------------------------------------------------------------------------------------------->

  <div class='page-result-right'>
    <canvas id='mycanvas' width='400' height='400'></canvas>
    <h3>Chart of Total Expense</h3>
    <br>

    <% let totalSum = foodSum +  transportSum  +  entertainmentSum %>

    <div class='summary'>
    <table>
      <tr>
        <td>Food & Drinks</td>
        <td><%= Math.round(( foodSum  / totalSum) * 100) %> %</td>
        <td><%= accounting.formatMoney(foodSum, "Rp. ", 0) %></td>
      </tr>
      <tr>
        <td>Transport</td>
        <td><%= Math.round((transportSum / totalSum) * 100) %> %</td>
        <td><%= accounting.formatMoney(transportSum, "Rp. ", 0) %></td>
      </tr>
      <tr>
        <td>Entertainment</td>
        <td><%= Math.round((entertainmentSum / totalSum) * 100) %> %</td>
        <td><%= accounting.formatMoney(entertainmentSum, "Rp. ", 0) %></td>
      </tr>
      <tr style="background-color: yellow; color: red">
        <td><b>Total Expense</b></td>
        <td><b>100 %</b></td>
        <td><b><%= accounting.formatMoney(totalSum, "Rp. ", 0) %><b></td>
      </tr>
    </table>
  </div>
  </div>

  <script>
    $(document).ready(()=> {
      let ctx = $('#mycanvas').get(0).getContext('2d')
      let totalSum = <%= foodSum %> + <%= transportSum %> + <%= entertainmentSum %>
      let data = [
        {
          value: Math.round((<%= foodSum %> / totalSum) * 100),
          color: 'red',
          highlight: 'pink',
          label: 'Food and Drinks'
        },
        {
          value: Math.round((<%= transportSum %> / totalSum) * 100),
          color: 'orange',
          highlight: 'yellow',
          label: 'Transport'
        },
        {
          value: Math.round((<%= entertainmentSum %> / totalSum) * 100),
          color: 'blue',
          highlight: 'lightblue',
          label: 'Entertainment'
        }
      ]
      let piechart = new Chart(ctx).Pie(data)
    })
  </script>

  </body>
</html>
